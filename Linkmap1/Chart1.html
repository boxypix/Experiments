<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>График скорости ветра и осадков</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        body {
            background-color: #212634;
            color: #9FA9C8;
            font-family: Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        #container {
            margin: 0 auto;
            height: 400px;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <script>
        // Координаты
        const lat = 27.615513;
        const lon = -82.736779;
        const apiUrl = `https://api.open-meteo.com/v1/gfs?latitude=${lat}&longitude=${lon}&past_days=1&hourly=windspeed_10m,windgusts_10m,precipitation&timezone=auto`;

        // Интервал дискретности в часах
        const intervalHours = 1; // Измените это значение на желаемый интервал (1, 2, 3, 6 и т.д.)

        // Функция для фильтрации данных
        const cleanData = (data, times) => {
            return data
                .map((value, i) => {
                    if (value !== null && value !== undefined) {
                        return [new Date(times[i]).getTime(), parseFloat(value.toFixed(2))];
                    }
                    return null;
                })
                .filter((point) => point !== null);
        };

        // Функция для фильтрации данных по дискретности
        const filterDataByInterval = (data, times, intervalHours) => {
            return data.filter((value, index) => {
                const date = new Date(times[index]);
                const hours = date.getHours();
                return hours % intervalHours === 0;
            });
        };

        // Получение данных и построение графика
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const times = data.hourly.time;

                // Фильтрация данных по дискретности
                const filteredTimes = filterDataByInterval(times, times, intervalHours);

                // Очистка и фильтрация данных
                const windSpeedData = cleanData(
                    filterDataByInterval(data.hourly.windspeed_10m.map(speed => speed * 0.539957), times, intervalHours),
                    filteredTimes
                );

                const windGustData = cleanData(
                    filterDataByInterval(data.hourly.windgusts_10m.map(gust => gust * 0.539957), times, intervalHours),
                    filteredTimes
                );

                const precipitationData = cleanData(
                    filterDataByInterval(data.hourly.precipitation, times, intervalHours),
                    filteredTimes
                );

                // Рендер графика
                Highcharts.chart('container', {
                    chart: {
                        type: 'line',
                        backgroundColor: '#212634',
                        scrollablePlotArea: {
                            minWidth: 6000,
                            scrollPositionX: 1
                        },
                    },
                    title: {
                        text: 'График скорости ветра и осадков',
                        style: {
                            fontSize: '16px',
                            color: '#9FA9C8'
                        }
                    },
                    xAxis: {
                        type: 'datetime',
                        tickInterval: 6 * 3600 * 1000, // Основные линии каждые 6 часов
                        gridLineWidth: 1, // Толщина вертикальных линий сетки
                        minorTickInterval: 1 * 3600 * 1000, // Нет минорных линий
                        minorGridLineColor: '#39435E', // Серые минорные линии
                        gridLineColor: '#FFF', // Черный цвет вертикальных линий
                        zIndex: 1, // Устанавливаем сетку поверх графиков
                        labels: {
                            style: {
                                fontSize: '12px',
                                color: '#9FA9C8'
                            }
                        },
                        title: {
                            text: null
                        },
                        min: windSpeedData[0][0],
                        max: windSpeedData[windSpeedData.length - 1][0] + 3600 * 1000
                    },
                    yAxis: [{
                        //tickAmount: 5, // Пять равномерно распределенных меток
                        max: 40,
                        tickInterval: 5,
                        title: {
                            text: 'Скорость ветра (узлы)',
                            style: {
                                fontSize: '14px',
                                color: '#9FA9C8'
                            }
                        },
                        labels: {
                            style: {
                                fontSize: '12px',
                                color: '#9FA9C8'
                            }
                        },
                        gridLineColor: '#39435E',
                        max: 50
                    }, {
                        visible: false,
                        title: {
                            text: 'Осадки (мм)',
                            style: {
                                fontSize: '14px',
                                color: '#60A5FA'
                            }
                        },
                        labels: {
                            style: {
                                fontSize: '12px',
                                color: '#60A5FA'
                            }
                        },
                        opposite: true
                    }],
                    tooltip: {
                        shared: true,
                        backgroundColor: '#39435E',
                        style: {
                            fontSize: '12px',
                            color: '#9FA9C8'
                        }
                    },
                    legend: {
                        enabled: true,
                        itemStyle: {
                            fontSize: '12px',
                            color: '#9FA9C8'
                        }
                    },
                    plotOptions: {
                        area: {
                            fillOpacity: 0.3,
                            lineColor: '#FFFFFF',
                            lineWidth: 2,
                            marker: {
                                enabled: false
                            },
                            threshold: null
                        },
                        column: {
                            pointWidth: 10,
                            borderWidth: 0,
                            color: 'rgba(96, 165, 250, 0.5)',
                            pointPadding: 0,
                            groupPadding: 0
                        },
                        series: {
                            marker: {
                                enabled: false
                            }
                        }
                    },
                    series: [{
                        name: 'Скорость ветра',
                        data: windSpeedData,
                        type: 'area',

                        zones: [{
                            value: 0,
                            fillColor: '#1A3748' // 0-5 узлов
                        }, {
                            value: 5,
                            fillColor: '#0092EA' // 5-10 узлов
                        }, {
                            value: 10,
                            fillColor: '#60DC25' // 10-15 узлов
                        }, {
                            value: 15,
                            fillColor: '#FEA901' // 15-20 узлов
                        }, {
                            value: 20,
                            fillColor: '#FE5501' // 20-25 узлов
                        }, {
                            value: 25,
                            fillColor: '#B20A05' // 25-30 узлов
                        }, {
                            value: 40,
                            fillColor: '#8B0962' // 30+ узлов
                        }],
                        threshold: null
                    }, {
                        name: 'Порывы ветра',
                        data: windGustData,
                        type: 'line',
                        color: 'rgba(255, 255, 255, 0.7)',
                        dashStyle: 'ShortDash',
                        shadow: {
        color: 'rgba(0, 0, 0, 0.5)', // Полупрозрачный черный цвет тени
        offsetX: 3, // Смещение тени по X
        offsetY: 3, // Смещение тени по Y
        opacity: 0.7, // Прозрачность тени
        width: 6 // Радиус размытия тени
    },
                        fillOpacity: 0
                    }, {
                        name: 'Осадки',
                        data: precipitationData,
                        type: 'column',
                        yAxis: 1
                    }]
                });
            })
            .catch(error => {
                console.error('Ошибка загрузки данных:', error);
            });
    </script>
</body>
</html>