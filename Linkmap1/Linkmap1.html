<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Interactive Map with Waves and Popups</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        .custom-popup {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            padding: 4px;
            color: #12242F;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        .popup-title {
            font-weight: 400;
            margin: 0 0 2px;
        }

        .popup-wind {
            font-weight: 700;
            margin: 0 0 2px;
        }

        .popup-distance {
            font-weight: 400;
            margin: 0;
        }

        .popup-problem {
            color: #FF581C;
            font-size: 12px;
            font-weight: bold;
            margin-top: 4px;
        }

        @keyframes wave {
            0% {
                transform: scale(1);
                opacity: 0.4;
            }
            100% {
                transform: scale(8);
                opacity: 0;
            }
        }

        .wave {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #1C3747;
            border-radius: 50%;
            pointer-events: none;
            animation: wave 3s infinite;
            transform-origin: center;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="wave-container"></div>
    <script>
        const centerCoords = [27.615513, -82.736779]; // Центр станции
        const spotNames = [
            "Bear Beach",
            "Happy Bolt Place",
            "Roman's Hill",
            "Surfhub",
            "Michael's Tower"
        ];

        const circleRadii = [100, 200, 300]; // Радиусы кругов
        const lineColor = '#567C91';
        const lineOpacity = 0.2;

        const windSpeeds = [12, 9, 15, 10, 11]; // Примерные значения ветра в узлах

        // Создаем карту
        const map = L.map('map').setView(centerCoords, 17);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Круги вокруг станции
        circleRadii.forEach(radius => {
            L.circle(centerCoords, {
                radius: radius,
                color: lineColor,
                weight: 2,
                opacity: lineOpacity,
                dashArray: '3, 3'
            }).addTo(map);
        });

        const spotsCoords = [
            [27.6158, -82.7355],
            [27.6161, -82.7375],
            [27.6149, -82.7380],
            [27.6156, -82.7340],
            [27.6150, -82.7370] // Broken spot
        ];

        const brokenSpot = spotsCoords[spotsCoords.length - 1];

        // Добавляем станцию
        const stationIcon = L.icon({
            iconUrl: './mats/Station.svg',
            iconSize: [248, 248], // Retina size
            iconAnchor: [124, 124]
        });
        L.marker(centerCoords, { icon: stationIcon }).addTo(map);

        // Функция для отображения popup
        function createPopupContent(name, wind, distance, isBroken = false) {
            let popupContent = `<div class="custom-popup">
                <div class="popup-title">${name}</div>
                <div class="popup-wind">${wind} kts</div>
                <div class="popup-distance">${distance} m</div>`;
            if (isBroken) {
                popupContent += `<div class="popup-problem">Problem</div>`;
            }
            popupContent += `</div>`;
            return popupContent;
        }

        // Добавляем споты, линии и расстояния
        spotsCoords.forEach((spot, index) => {
            const isBroken = spot === brokenSpot;

            const spotIcon = L.icon({
                iconUrl: isBroken ? './mats/Spot2.svg' : './mats/Spot1.svg',
                iconSize: [102, 102], // Retina size
                iconAnchor: [51, 51]
            });

            const marker = L.marker(spot, { icon: spotIcon }).addTo(map);

            const lineColor = isBroken ? '#FF581C' : '#FFFFFF';
            const lineClass = isBroken ? 'orange-line' : '';

            const polyline = L.polyline([spot, centerCoords], {
                color: lineColor,
                weight: 3, // Толщина линии 3px
                className: lineClass
            }).addTo(map);

            // Расстояние до станции
            const distance = Math.round(map.distance(spot, centerCoords)); // В метрах, округлено

            // Добавляем popup с возможностью повторного открытия
            const popup = L.popup({
                offset: [0, -16], // Смещение на 16px выше маркера
                closeButton: true
            }).setContent(createPopupContent(spotNames[index], windSpeeds[index], distance, isBroken));

            marker.on('click', () => {
                popup.setLatLng(spot).openOn(map);
            });
        });

        // Функция для добавления волны
        function createWave() {
            const wave = document.createElement('div');
            wave.className = 'wave';

            const mapContainer = document.getElementById('wave-container');
            mapContainer.style.position = 'absolute';
            mapContainer.style.top = '0';
            mapContainer.style.left = '0';
            mapContainer.style.width = '100%';
            mapContainer.style.height = '100%';
            mapContainer.style.pointerEvents = 'none';

            const stationPoint = map.latLngToContainerPoint(centerCoords);
            wave.style.left = `${stationPoint.x}px`;
            wave.style.top = `${stationPoint.y}px`;

            mapContainer.appendChild(wave);

            setTimeout(() => {
                wave.remove();
            }, 3000);
        }

        // Запускаем волны каждые 3 секунды
        setInterval(createWave, 3000);
    </script>
</body>
</html>
